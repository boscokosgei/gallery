(()=>{var e={4:(e,t,o)=>{const s=o(252).Router();o(903);let r=o(79);o(16);let i=o(656);s.get("/",((e,t)=>{i.find({},(function(o,s){o&&console.log(o),t.render("index",{images:s,msg:e.query.msg})}))})),s.post("/upload",((e,t)=>{r(e,t,(o=>{o?t.redirect(`/?msg=${o}`):(console.log(e.file),null==e.file?t.redirect("/?msg=Error: No file selcted!"):(new i({name:e.file.filename,size:e.file.size,path:"images/"+e.file.filename}).save(),t.redirect("/?msg=File uploaded successfully")))}))})),e.exports=s},16:e=>{"use strict";e.exports=require("url")},37:e=>{"use strict";e.exports=require("mongoose")},79:(e,t,o)=>{const s=o(461),r=o(928),i=s.diskStorage({destination:"./public/images/",filename:function(e,t,o){o(null,t.fieldname+"-"+Date.now()+r.extname(t.originalname))}}),n=s({storage:i,limits:{fileSize:1e6},fileFilter:function(e,t,o){!function(e,t){const o=/jpeg|jpg|png|gif/,s=o.test(r.extname(e.originalname).toLowerCase());if(o.test(e.mimetype)&&s)return t(null,!0);t("Error: Images Only!!")}(t,o)}}).single("image");e.exports=n},252:e=>{"use strict";e.exports=require("express")},268:e=>{"use strict";e.exports=require("body-parser")},393:(e,t,o)=>{const s=o(252).Router();let r=o(656);s.get("/:id",((e,t)=>{r.findById(e.params.id,(function(e,o){e&&console.log(e),t.render("singleImage",{title:"Single Image",image:o})}))})),s.put("/:id",((e,t)=>{console.log(e.params.id),console.log(e.body),r.findOneAndUpdate({_id:e.params.id},{name:e.body.name},{new:!0},(function(e,o){e&&console.log(e),t.redirect("/")}))})),s.delete("/:id",((e,t)=>{console.log(e.params.id),r.deleteOne({_id:e.params.id},(function(e){e&&console.log(e),t.redirect("/index")}))})),e.exports=s},461:e=>{"use strict";e.exports=require("multer")},656:(e,t,o)=>{const s=o(37);var r=new(0,s.Schema)({name:String,path:String,size:Number,date:{type:Date,default:Date()}});let i=s.model("Image",r);e.exports=i},903:e=>{"use strict";e.exports=require("uuid")},928:e=>{"use strict";e.exports=require("path")}},t={};function o(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,o),i.exports}const s=o(252),r=(o(268),o(37)),i=o(928);let n=o(4),l=o(393);r.connect("mongodb+srv://bosskoech:nHXcO9RFOhfUluX1@gallery.yvznhac.mongodb.net/?retryWrites=true&w=majority&appName=Gallerydarkroom",{useNewUrlParser:!0,useUnifiedTopology:!0},(e=>{e&&console.log(e)})),r.connection.once("open",(()=>{console.log("Database connected successfully")}));const a=s();a.set("view engine","ejs"),a.use(s.static(i.join(__dirname,"public"))),a.use(s.json()),a.use("/",n),a.use("/image",l);const c=process.env.PORT||5e3;a.listen(c,(()=>{console.log(`Server is listening at http://localhost:${c}`)}))})();